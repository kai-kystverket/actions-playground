name: Build and push
on:
  workflow_call:
    inputs:
      context:
        description: 'directory to use'
        required: true
        type: string
      release:
        description: Event type release
        required: true
        default: false
        type: boolean
      pull_request:
        description: Event type pull request
        required: true
        default: false
        type: boolean
jobs:
  build-dev:
    runs-on: ubuntu-latest
    environment: dev
    if: ${{ inputs.release == false }}
    steps:
      - name: build
        run: |
          echo building $CONTEXT-$ENV
        env:
          CONTEXT: ${{ inputs.context }}
          ENV: ${{ github.env }}
      - name: deploy
        if: ${{ inputs.pull_request == false }}
        run: |
          echo deploying $CONTEXT-$ENV
        env:
          CONTEXT: ${{ inputs.context }}
          ENV: ${{ github.env }}
  build-test:
    needs: build-dev
    runs-on: ubuntu-latest
    environment: test
    if: ${{ inputs.release == false }}
    steps:
      - name: build
        run: |
          echo building $CONTEXT-$ENV
        env:
          CONTEXT: ${{ inputs.context }}
          ENV: ${{ github.env }}
      - name: deploy
        if: ${{ inputs.pull_request == false }}
        run: |
          echo deploying $CONTEXT-$ENV
        env:
          CONTEXT: ${{ inputs.context }}
          ENV: ${{ github.env }}
  build-prod:
    runs-on: ubuntu-latest
    environment: prod
    if: ${{ inputs.release }}
    steps:
      - name: build
        run: |
          echo building $CONTEXT-$ENV
        env:
          CONTEXT: ${{ inputs.context == true }}
          ENV: ${{ github.env }}
      - name: deploy
        if: ${{ inputs.pull_request == false }}
        run: |
          echo deploying $CONTEXT-$ENV
        env:
          CONTEXT: ${{ inputs.context }}
          ENV: ${{ github.env }}
